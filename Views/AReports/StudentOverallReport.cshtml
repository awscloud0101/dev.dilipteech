@model AsteriskBrowserAL.Models.StudentDetailsData

@{
    ViewBag.Title = "StudentOverallReport";
}


@section BreadCrumb{

    <ul class="breadcrumb">
        <li>
            <i class="menu-icon fa fa-graduation-cap"></i>
            Academics
        </li>
        <li>
            <i class=""></i>
            Reports
        </li>
        <li class="active">Student Overall Report</li>
    </ul><!-- /.breadcrumb -->
}





<link href="~/assets/css/jquery-ui.custom.min.css" rel="stylesheet" />
<script src="~/assets/js/jquery-ui.min.js"></script>

<style>
    .ui-widget.ui-widget-content {
        border: 1px solid #c5c5c5;
        width: 19em;
    }
</style>

<style type="text/css">
    .ui-autocomplete {
        font-size: 12px;
        cursor: pointer;
        width: 120px;
        height: 120px;
        overflow-y: scroll;
    }
</style>

<!--Main Content-->
<section class="content">
    <div class="row">
        <div class="col-xs-12">
         
            @using (Html.BeginForm())
            {
                <!-- form start -->

                @Html.AntiForgeryToken()

            <div class="row">
         
                <div class="col-xs-12">

                    <div class="table-header">
                        <span style="font-family:calibri;"> Student Overall Report</span>
                        <div class="inline" style="float:right;margin-right:10px;">

                            <button class="btncustom P2" onclick="return PrintStudentOverallReport('#mydiv');">
                          Print
                            </button>
                        </div>

                    </div>
                    <div class="widget-box">


                        <div class="widget-body">
                            <div class="widget-main">
                                @if (Model.IsCentral)
                                {
                                    <div class="row">
                                        <div class="col-xs-12">
                                            <div class="col-xs-6">
                                                <label class="col-sm-4">Division</label>
                                                <div class="col-sm-6">
                                                    @Html.DropDownListFor(model => model.DivisionId, new SelectList(Model.lstDivision, "DivisionId", "DivisionName"), new { @class = "form-control", id = "DivisionId" })
                                                </div>
                                            </div>

                                            <div class="col-xs-6">
                                                <label class="col-sm-4">Branch</label>
                                                <div class="col-sm-6">
                                                    <select id="BranchId" name="SubscriptionId" class="form-control"></select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                
                                }
                                <div class="row">
                                    <div class="col-xs-12">
                                        <div class="col-xs-6">
                                            <label class="col-sm-4">Section</label>
                                            <div class="col-sm-6">
                                                <select id="SectionId" name="SectionId" class="form-control"></select>
                                            </div>
                                        </div>

                                        <div class="col-xs-6">
                                            <label class="col-sm-4">@Html.Label("Select Student")</label>
                                            <div class="col-sm-6">


                                                <input type="text" name="StudentName" id="StudentId" spellcheck="false" oninput="removeError();" class="form-control" />
                                                <div class="" style="display:none;" id="Student">
                                                    <label style="color:red;font-weight:bold;"> Please Select Student </label>
                                                </div>
                                            </div>

                                            @*<div class="col-sm-4">
                            @Html.DropDownList("StudentId", null, "--- Select ---", new { @class = "form-control" ,onchage="removeError();" })
                        </div>*@
                                            

                                        </div>




                                    </div>
                                </div>

                                <div class="hr hr-18 dotted hr-double"></div>
                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <input class="col-sm-1" type="checkbox" id="selectall" vlaue="1" onclick="selectallcheckboxes(); removeError();" /><label for="selectall">Select /UnSelect All Reports</label>
                                        </div>
                                        <div class="col-sm-3" style="display:none;" id="allReport">
                                            <label style="color:red;font-weight:bold;"> Please Select Report </label>
                                        </div>
                                    </div>
                                </div>

                            

                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <input class="case col-sm-1" type="checkbox" id="sDetails" vlaue="1" onclick="removeError();" /><label for="sDetails">Student Details</label>
                                        </div>

                                        <div class="col-sm-3">
                                            <input class="case col-sm-1" type="checkbox" id="attendance" vlaue="2" onclick="removeError();" /><label for="attendance">Attendance Report</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <input class="case col-sm-1" type="checkbox" id="tpayments" vlaue="3" onclick="removeError();" /><label for="tpayments">Transport Payments</label>
                                        </div>
                                        <div class="col-sm-3">
                                            <input class="case col-sm-1" type="checkbox" id="fpayments" vlaue="4" onclick="removeError();" /><label for="fpayments">Fee Payments</label>
                                        </div>
                                    </div>
                                </div>
                        
                            </div>

                            </div>
                        </div>
                    </div>
                </div>


               

            }
        </div>
    </div>
    <input type="hidden" id="count" name="count" value="0" />
</section>


<div id="StudentOverall" style="display:none;">

</div>


    <script type="text/javascript">  
       function removeError()
        {
           document.getElementById("allReport").style.display = "none";
            //document.getElementById("allReport").style.display = "none";
        };


        function cursorwait(e) {
            document.body.style.cursor = 'wait';
        }


        function selectallcheckboxes() {
            var checked = document.getElementById("selectall").checked;
            if (checked == true) {
                var res = document.getElementsByClassName("case");
                for (var i = 0; i < res.length; i++) {
                    var val = res[i];
                    val.checked = true;
                }
            }

            if (checked == false) {
                var res = document.getElementsByClassName("case");
                for (var i = 0; i < res.length; i++) {
                    var val = res[i];
                    val.checked = false;
                }
            }
        };

        $(".case").click(function () {
                    if ($(".case").length == $(".case:checked").length) {
                        $("#selectall").attr("checked", "checked");
                      
                    }
                });

    </script>

    <script type="text/javascript">


        $(document).ready(function () {         
            GetSectionList();
           
        });



        var StudentId = 0;
        //auto complete Student Name

        $("#StudentId").keyup(function () {
            //if (!this.value) {
                StudentId = 0;
            //}
        })

        $("#StudentId").autocomplete({           
            source: function (request, response) {
                var BranchId = $('#BranchId').val();
                var SectionId = $('#SectionId').val();
                if (SectionId >= 0) {
                    $('#imagemodal').show();
                    $.ajax({
                        url: "/AReports/GetStudentsForOverallReport",
                        type: "POST",
                        dataType: "json",
                        data: { strVal: request.term, nBranchId: BranchId, nSectionId: SectionId },
                        success: function (json) {
                            response($.map(json, function (data, id) {
                                return {
                                    label: data.FullName,
                                    value: data.FullName,
                                    Id: data.StudentId,
                                    valueAsNumber: data.StudentId,
                                };
                            }));
                        },
                        error: function () {
                            $('#imagemodal').hide();
                        },
                    }).done(function () {
                        $('#imagemodal').hide();
                    });
                }               
            },
            minLength: 3,

            select: function SelectEvent(event, ui) {
                StudentId = ui.item.Id;
               
            }
        });


       

        function PrintStudentOverallReport(value) {
            debugger
            var studentId = StudentId;
            var BranchId =$('#BranchId').val();
            if (studentId < 1) {
                document.getElementById("Student").style.display = "inline";
                return false;
            } else {
                document.getElementById("Student").style.display = "none";
            }

            var sDetails = document.getElementById("sDetails").checked;
            var attndnc = document.getElementById("attendance").checked;
            var tpayments = document.getElementById("tpayments").checked;
            var fpayments = document.getElementById("fpayments").checked;

            if (sDetails == false && attndnc == false && tpayments == false && fpayments == false) {
                document.getElementById("allReport").style.display = "inline";
                return false;
            } else {
                document.getElementById("allReport").style.display = "none";
            }          
            cursorwait();
            $('#imagemodal').show();
            $.ajax({
                url: '/AReports/StudentOverallReportPrint',
                data: { studentId: studentId, sDetails: sDetails, attendance: attndnc, tpayments: tpayments, fpayments: fpayments, nBranchId: BranchId },
                success: function (data) {
                    $('#imagemodal').hide();
                    $('#StudentOverall').html(data);
                    var IsTranportPaymentDone = $('#IsTransportPaymentDone').val();
                    var IsFeePaymentDone = $('#IsFeePaymentDone').val();
                    var StudentDetails = $('#studentDetails').val();

                    if (sDetails == true) {
                        $('#studentDetails').show();

                    }
                    if (tpayments == true) {
                        $('#IsTransportPaymentDone').show();

                    }
                    if (tpayments == true) {
                        $('#IsFeePaymentDone').show();
                    }

                    PrintElem("#StudentOverall");
                },

            });
                document.body.style.cursor = 'default';
                return false;
        };


        function GetGender(value) {
            if (value == 0)
                return "Female";
            if (value == 1)
                return "Male";
            else
                return "--";
        };

        function GetPaymentMode(value) {
            if (value == 1)
                return "Cash";
            if (value == 2)
                return "Demand Draft";
            if (value == 3)
                return "Cheque";
            if (value == 4)
                return "Parent's Deposit";
            if (value == 5)
                return "Swipe";
        };

        function getFormattedDate(input) {
            var pattern = /(.*?)\/(.*?)\/(.*?)$/;
            var result = input.replace(pattern, function (match, p1, p2, p3) {
                var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                return (p2 < 10 ? "0" + p2 : p2) + " - " + months[(p1 - 1)] + " - " + p3;
            });
            return result;
        };


        function PrintElem(elem) {

			setTimeout(function () { Popup($(elem).html()); }, 5000);
        }

        function Popup(data) {

            var mywindow = window.open('', 'my div', 'height=300,width=600');
            mywindow.document.write('<p></p>');
            mywindow.document.write(data);
            mywindow.document.write('<p></p>');

            mywindow.document.close();
            mywindow.focus();

            mywindow.print();
            mywindow.close();
            return true;
        }


        $('#DivisionId').change(function () {

            var nDivisionId = $('#DivisionId').val();
            if (nDivisionId != 0) {
                $.ajax({

                    url: '/AReports/GetStudentStrengthBranchesByDivisionId',
                    data: { DivisionId: nDivisionId },
                    success: function (data) {

                        var BranchItems = $('#BranchId');

                        BranchItems.children().remove();

                        BranchItems.append($("<option>").val("null").text("--- Select ---"));
                  
                        $.each(data, function (i, record) {
                            BranchItems.append($("<option>").val(record.SubscriptionId).text(record.Institute));
                        });

                        $('#BranchId').append(BranchItems);
                        
                    },
                    aync: false
                });
            }
        });


        $('#BranchId').change(function () {
            var BranchId = $('#BranchId').val();
            if (BranchId > 0) {
                GetSectionList();
            }
        })




        function GetSectionList() {
            var nDivisionId = $('#DivisionId').val();
            var BranchId = $('#BranchId').val();           
            $.ajax({
                url: '/AReports/GetSectionsList',
                data: { nBranchId: BranchId },
                success: function (data) {

                    var SectionItems = $('#SectionId');

                    SectionItems.children().remove();

                    SectionItems.append($("<option>").val("null").text("--- Select ---"));
                    $.each(data, function (i, record) {
                        SectionItems.append($("<option>").val(record.SectionId).text(record.SectionCode));
                    });
                    $('#SectionId').append(SectionItems);
                }
            });
        }

 
    </script>


