@model AsteriskBrowserAL.Models.StaffBranchTransferData
@{
    ViewBag.Title = "Branch Transfer";
}


<style>
    .field-validation-error {
        color: red;
        font-weight: bold;
    }
</style>


<link href="~/assets/css/jquery-ui.custom.min.css" rel="stylesheet" />
<script src="~/assets/js/jquery-ui.min.js"></script>

<style type="text/css">
    .ui-autocomplete {
        font-size: 12px;
        cursor: pointer;
        width: 120px;
        height: 120px;
        overflow-y: scroll;
    }
</style>


@section BreadCrumb{

    <ul class="breadcrumb">
        <li>
            <i class="menu-icon fa fa-group"></i>
            HR
        </li>
        <li>
            <i class=""></i>
            Operations
        </li>
        <li class="active">Staff Branch Transfer</li>
    </ul><!-- /.breadcrumb -->
}



<section class="content">
  
    @if (null != TempData["Message"])
    {
        <label style="color:green">@TempData["Message"]</label>
    }
    <div class="row">
        <div class="col-sm-12">
            @using (Html.BeginForm("StaffBranchTransferRequest", "HROperations", FormMethod.Post))
            {
                <input type="hidden" name="StaffId" id="StaffId"/>
                <div class="row">
                    <div class="col-sm-12">
                        <span style="color:red;font-weight:bold" id="Validation"></span>


                        <div class="table-header">
                            <span style="font-family:calibri;">Transfer Request</span>
                            <div  style="float:right;margin-right:10px;">
                                <button class=" btncustom P2" type="submit" id="ViewData"  name="Request" onclick="return submitForm();">
                                      Request</button>
                            </div>

                        </div>




                        <div class="widget-box">
                            @*<div class="box-header">
                                <h3 class="box-title">Staff Branch Transfer Request</h3>

                                <button class="btn btn-primary col-sm-1" style="float:right;width:80px" type="submit" onclick="return submitForm()">
                                    Request
                                </button>
                            </div>*@


                            <!-- /.box-header -->
                            <!-- form start -->
                            <div class="widget-body">
                                <div class="widget-main">

                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="col-sm-6">
                                                <label class="col-sm-6">@Html.Label("From Division")</label>
                                                <div class="col-sm-6">
                                                    <select id="FromDivision" name="FromDivision" class="form-control"></select>
                                                    <span class="" style="color:red;font-weight:bold" id="FromDivisionVal"></span>
                                                </div>
                                            </div>
                                            
                                        
                                            <div class="col-sm-6">
                                                <label class="col-sm-6">@Html.Label("From Branch")</label>
                                                <div class="col-sm-6">
                                                    <select id="FromBranch" name="FromBranch" class="form-control"></select>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                              
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="col-sm-6">
                                                <label class="col-sm-6">@Html.Label("Search Staff")</label>
                                                <div class="col-sm-6">
                                                    <input type="text" id="Staff" name="Staff" class="form-control" />
                                                </div>
                                                <span class="" style="color:red;font-weight:bold" id="StaffIdVal"></span>
                                            </div>
                                            <div class="col-sm-6">
                                                <label class="col-sm-6">@Html.Label("Reason")</label>
                                                <div class="col-sm-6">
                                                    <input type="text" id="Reason" name="Reason" class="form-control" />
                                                </div>
                                                <span class="" style="color:red;font-weight:bold" id="ReasonVal"></span>
                                            </div>
                                        </div>
                                    </div>
                             

                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="col-sm-6">
                                                <label class="col-sm-6">@Html.Label("To Branch")</label>
                                                <div class="col-sm-6">
                                                    <select id="ToBranch" name="ToBranch" class="form-control"></select>
                                                </div>
                                                <span class="" style="color:red;font-weight:bold" id="ToBranchVal"></span>
                                            </div>

                                 
                                       
                                        </div>

                                    </div>
                                  
                          
                          
                                </div>
                            </div><!-- /.box-header -->

                        </div>
                        </div>
                </div>

            }
        </div>

    </div>

    <div id="imagemodal" style="margin: 0px; padding: 0px; position: fixed; right: 0px;
    top: 0px; width: 100%; height: 100%; background-color: #666666; z-index: 30001;
    opacity: .8; filter: alpha(opacity=70);display:none">
        <p style="position:absolute; top: 50%; left:50%;">
            <img height="50" width="50" src="~/LoaderImages/ajax-loader.gif" />
        </p>
    </div>
    <input type="hidden" id="count" name="count" value="0" />
</section>

<script type="text/javascript">

       $(document).ready(function () {

      GetDivisions();
       });

       function GetDivisions()
       {
           $.ajax({
               url: '/HROperations/GetDivisions',
               data: { IsAll: false },
               success: function (data) {
                   var FromDivisionItems = $('#FromDivision');

                   FromDivisionItems.children().remove();

                   //DescBranchItems.append($("<option>").val("0").text("--- Select ---"));

                   $.each(data, function (i, record) {
                       FromDivisionItems.append($("<option>").val(record.DivisionId).text(record.DivisionName));
                   });

                   $('#FromDivision').append(FromDivisionItems);
               },
               aync: false
           });
       }

       $('#FromDivision').change(function () {

           $('#FromBranch').children().remove();
           $('#Staff').val("");
           $('#StaffId').val(0);
           $('#ToBranch').children().remove();

           GetBranches();
       })

       function GetBranches()
       {
           var DivisionId = $('#FromDivision').val();
           if (DivisionId != 0) {
               $.ajax({
                   url: '/Common/GetBranchesByDivision',
                   data: { DivisionId: DivisionId, IsAll: false },
                   success: function (data) {
                       var DescBranchItems = $('#FromBranch');

                       DescBranchItems.children().remove();

                       $.each(data, function (i, record) {
                           DescBranchItems.append($("<option>").val(record.SubscriptionId).text(record.Institute));
                       });

                       $('#FromBranch').append(DescBranchItems);

                   },
                   aync: false
               });
           }
       }


       $('#FromBranch').change(function () {

           $('#Staff').val("");
           $('#StaffId').val(0);
           $('#ToBranch').children().remove();

           var FromBranch = $('#FromBranch').val();

           if(FromBranch > 0)
           {
               GetTransferToBranches();
           }
       });

       function GetTransferToBranches()
       {
           var FromBranch = $('#FromBranch').val();

           $.ajax({
               url: '/Common/GetBranches',
               success: function (data) {
                   var ToBranchItems = $('#ToBranch');

                   ToBranchItems.children().remove();
                   ToBranchItems.append($("<option>").val("").text("--- Select ---"));
                   $.each(data, function (i, record) {

                       if (record.SubscriptionId != FromBranch) {
                           ToBranchItems.append($("<option>").val(record.SubscriptionId).text(record.Institute));
                       }
                   });

                   $('#ToBranch').append(ToBranchItems);
               },
               aync: false
           });
       }


    $("#Staff").autocomplete({
        source: function (request, response) {
            var FromBranch = $('#FromBranch').val();

            if (FromBranch < 1 || request.term.length < 3)
            {
                return;
            }

            $('#imagemodal').show();
            $.ajax({
                url: "/HROperations/GetStaffBySubId",
                data: { SubscriptionId: FromBranch, strVal: request.term },
                success: function (json) {
                    response($.map(json, function (data, id) {
                        return {
                            label: data.DisplayName,
                            value: data.DisplayName,
                            id: data.StaffId,
                        };
                    }));
                },
                error: function () {
                    $('#imagemodal').hide();
                },
            }).done(function () {
                $('#imagemodal').hide();
            });
        },
        minLength: 3,
        select: function (event, ui) {
            document.getElementById('StaffId').value = ui.item.id
        }
    });

    function submitForm() {

        var validatestatus = validateBranchTransfer();
        if (validatestatus == false) {
            return false;
        } else {
            return true;
        }
    };

    function validateBranchTransfer() {

        //var FromDivision = $('#DivisionId').val(); //parseInt($('#DivisionId').val());
        //var FromBranch = $('#CboBranch').val();
        var FromDivision = parseInt($('#FromDivision').val());
        var FromBranch = $('#FromBranch').val();
        var StaffId = $('#StaffId').val();
        var ToBranch = $('#ToBranch').val();
        var Reason = $('#Reason').val();

       var validate = true;

        if (FromDivision < 1) {
            document.getElementById('FromDivisionVal').innerHTML = "Select From Division";
            validate = false;
        }

        if (FromBranch < 1) {
            document.getElementById('FromBranchVal').innerHTML = "Select From Branch";
            validate = false;
        } 

        if (StaffId == "" || StaffId < 1 || StaffId == "null") {
            document.getElementById("StaffIdVal").innerHTML = "Select Staff";
            validate = false;
        } 

        if (ToBranch == "" || ToBranch < 1) {
            document.getElementById("ToBranchVal").innerHTML = "Select To Branch";
            validate = false;
        } 

        if (Reason == "" ) {
            document.getElementById("ReasonVal").innerHTML = "Enter reason";
            validate = false;
        }

        return validate;
    };


    $('#FromDivision').change(function () {
        document.getElementById('FromDivisionVal').innerHTML = "";
    })

    $('#FromBranch').change(function () {
        document.getElementById('FromBranchVal').innerHTML = "";
    })

    $('#ToBranch').change(function () {
        document.getElementById("ToBranchVal").innerHTML = "";
    })

    $('#Staff').change(function () {
        document.getElementById("StaffIdVal").innerHTML = "";
    })

    $('#Reason').focus(function () {
        document.getElementById("ReasonVal").innerHTML = "";
    })

</script>

