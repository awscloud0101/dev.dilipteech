@model AsteriskBrowserAL.Models.Mail

@{
    ViewBag.Title = "ComposeMail";
    int subscriptionId = @ViewBag.SubId;
    Layout = null;

}
<script src="//cdn.ckeditor.com/4.5.5/standard/ckeditor.js"></script>
<span style="color:red;font-weight:bold" id="MsgValidation" class="col-xs-12"></span>
<br />
@using (Html.BeginForm("ComposeMailPost", "AStudent", FormMethod.Post, new { @class = "form-horizontal" }))
{
    <form class="form-horizontal col-sm-12">
        <div>
            <div class="form-group">
                <div class="col-xs-6">
                    <label class="col-sm-3 control-label no-padding-right" for="form-field-subject"><span style="color:red;font-weight:bold">*C</span>lass: &nbsp;</label>
                    <div class="col-sm-9">
                        <div class="input-icon block col-xs-12 no-padding">
                            @Html.DropDownList("ClassId", null, "--Select--", new { @class = "form-control", @id = "ClassId" })
                        </div>
                    </div>
                </div>
                <div class="col-xs-6">
                    <label class="col-sm-3 control-label no-padding-right" for="form-field-subject"><span style="color:red;font-weight:bold">*S</span>ection: &nbsp;</label>
                    <div class="col-sm-9">
                        <div class="input-icon block col-xs-12 no-padding">
                            <select id="SectionId" name="SectionId" class="form-control"></select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                    <label class="col-sm-2 control-label no-padding-right" for="form-field-subject"><span style="color:red;font-weight:bold">*S</span>tudent: &nbsp;</label>
                    <div class="col-sm-9">
                        <div class="input-icon block col-xs-12 no-padding">
                            <select id="studentId" name="studentId" class="form-control"></select>
                        </div>
                    </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label no-padding-right" for="form-field-subject"><span style="color:red;font-weight:bold">*S</span>ubject: &nbsp;</label>
                <div class="col-sm-9">
                    <div class="input-icon block col-xs-12 no-padding">
                        <input maxlength="100" type="text" class="col-xs-12" name="subject" id="subject" placeholder="Subject" />
                        <i class="ace-icon fa fa-comment-o"></i>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label no-padding-right" for="form-field-subject"><span style="color:red;font-weight:bold">*C</span>ontent: &nbsp;</label>
                <div class="col-sm-9">
                    <div class="input-icon block col-xs-12 no-padding">
                        <textarea class="form-control col-sm-5 textlength" placeholder="Content" id="Content" name="Content"></textarea>
                        <script type="text/javascript">
                            CKEDITOR.replace('Content',{
                                height: 160
                            });
                             
                        </script>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-6 control-label no-padding-right" for="form-field-subject"></label>
                <div class="col-sm-6 right">
                    <button class="btn btn-success btn-minier" type="submit" onclick="return Validation()">
                        <i class='ace-icon bigger-110'></i>Send
                    </button>
                    <button class="btn btn-minier" onclick="return CloseWindow()" type="button">
                        <i class='ace-icon bigger-110'></i>Close
                    </button>
                </div>
            </div>
        </div>
    </form>
}

<script type="text/javascript">

    $('#ClassId').change(function () {
        debugger
        var classId = $('#ClassId').val()
        if (classId > 0) {
            LoadSection(classId)
        }
    })
    function CloseWindow() {
        debugger
        $("#dialog-confirm").dialog('close')
    }
    function LoadSection(classId) {
        debugger
        $.ajax({
            url: '/AReports/GetSections',
            data: { nClassNumberId: classId, nSubId: @subscriptionId },
            success: function (result) {
                SectionId = $("#SectionId")
                SectionId.children().remove();
                SectionId.append($("<option>").val("").text("--- Select ---"))
                $.each(result, function (i, elm) {
                    SectionId.append($("<option>").val(elm.SectionId).text(elm.SectionCode))
                })
                $("#SectionId").append(SectionId)
            }
        })
    }

    $('#SectionId').change(function () {
        debugger
        var sectionId = $('#SectionId').val()
        if (sectionId > 0) {
            LoadStudent(sectionId)
        }
    })

    function LoadStudent(sectionId) {
        $.ajax({
            url: '/AStudent/GetStudentsBySectionId',
            data: { SectionId: sectionId, nSubId: @subscriptionId },
            success: function (result) {
                debugger
                SentToId = $("#studentId")
                SentToId.children().remove();
                SentToId.append($("<option>").val("").text("--- Select ---"))
                $.each(result, function (i, elm) {
                    SentToId.append($("<option>").val(elm.StudentId).text(elm.DisplayName))
                })
                $("#studentId").append(SentToId)
            }
        })
    }


    function Validation() {
        debugger
        var validation = true
        var SectionId = $('#SectionId').val()
        var SentToId = $('#studentId').val()
        var ClassId = $('#ClassId').val()
        var Subject = $('#subject').val()
        var Content = CKEDITOR.instances.Content.getData();

        if (ClassId == "" || ClassId == null || ClassId == "0"){
            validation = false
        }
        if (SectionId == "" || SectionId == null || SectionId == "0") {
            validation = false
        }
        if (SentToId == "" || SentToId == null || SentToId =="0") {
            validation = false
        }
        if (Subject == "" || Subject == null) {
            validation = false
        } if (Content == "" || Content == null || Content == " ") {
            validation = false
        }
        if (validation == false) {
            document.getElementById('MsgValidation').innerHTML = "select all mandatory feilds"
        }
        return validation;
    }


</script>