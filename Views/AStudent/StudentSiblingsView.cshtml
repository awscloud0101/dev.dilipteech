@model AsteriskBrowserAL.Models.StudentAdmissionData
@{
    int sno = 1;
}
@if (null != Model)
{

    <input type="hidden" id="SchoolType" value="@Model.SiblingType" name="SiblingType" />
    if (null != Model.SiblingList && Model.SiblingList.Count() > 0)
    {

        <div class="col-xs-12">
            <div class="box">
                <div class="box-body">
                    <table class="table table-hover stripe" id="TableSibling">
                        <thead>
                            <tr>
                                <th class="centerAlign">
                                   S.No.
                                </th>
                                @if (Model.SiblingType == 1)
                                {
                                    <th>
                                        @Html.DisplayName("Branch")
                                    </th>
                                }
                                else
                                {
                                    <th>
                                        @Html.DisplayName("School Name")
                                    </th>
                                    <th>
                                        @Html.DisplayName("Class")
                                    </th>
                                }

                                <th>
                                    @Html.DisplayName("Name")
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (null != Model)
                            {
                                for (int i = 0; i < Model.SiblingList.Count(); i++)
                                {
                                    <tr>
                                        <td class="centerAlign">
                                            @Html.Hidden("SiblingList.Index", (@i + 10))
                                            @sno
                                        </td>
                                        @if (Model.SiblingType == 1)
                                        {
                                            <td>
                                                @Html.DropDownList("SiblingList[" + (@i + 10) + "].SubscriptionId", new SelectList(Model.BranchData, "SubscriptionId", "Institute", Model.SiblingList.ElementAt(i).SubscriptionId), "--- Select ---", new { @class = "form-control " + @sno + "Sibling", @required = "required" })
                                                @Html.Hidden("SiblingList[" + (@i + 10) + "].SubscriptionId", Model.SiblingList.ElementAt(i).SubscriptionId)
                                            </td>
                                        }
                                        else
                                        {
                                            <td>
                                                @Html.TextBox("SiblingList[" + (@i + 10) + "].SchoolName", Model.SiblingList.ElementAt(i).SchoolName, new { @required = "required", @class = "row2" })
                                                @Html.Hidden("SiblingList[" + (@i + 10) + "].SchoolName", Model.SiblingList.ElementAt(i).SchoolName)
                                            </td>

                                            <td>
                                                @Html.TextBox("SiblingList[" + (@i + 10) + "].ClassName", Model.SiblingList.ElementAt(i).ClassName)
                                                @Html.Hidden("SiblingList[" + (@i + 10) + "].ClassName", Model.SiblingList.ElementAt(i).ClassName)
                                            </td>
                                        }

                                        <td>

                                            @Html.TextBox("SiblingList[" + (@i + 10) + "].StudentName", Model.SiblingList.ElementAt(i).SiblingName, new { @id = @sno + "Sibling", @onkeypress = "SearchStudent(" + @sno + ")", @class = "form-control row2", @required = "required" })
                                            @Html.Hidden("SiblingList[" + (@i + 10) + "].StudentName", Model.SiblingList.ElementAt(i).SiblingName)
                                        </td>



                                    </tr>

                                        sno++;
                                }

                            }
                        </tbody>
                    </table>
                </div>

            </div>

        </div>

        <br />

    }


}

        @*<input id="Data" onclick="SearchStudent()" />
            <script src="~/Scripts/tautocomplete.js" type="text/javascript"></script>

            <link rel="stylesheet" type="text/css" href="~/stylesheets/tautocomplete.css" />*@
        <script>

            function SearchStudent(id) {
                document.getElementById("siblingsVal").innerHTML = "";

                var Count = 0;
                var SelSubscription = $("." + id + "Sibling").val();
                var SyblingCoutStudents = $("#SyblingCoutStudents").val();
                Count = SyblingCoutStudents + Count;
                var SchoolType = $("#SchoolType").val();
                //var countryData = new Array();
                var searchData = $("#" + id + "Sibling").val();



                $("#" + id + "Sibling").autocomplete({
                    source: function (request, response) {
                        if (request.term.length >= 3) {
                            Count = Count + 1

                            document.getElementById("SyblingCoutStudents").value = SyblingCoutStudents;
                            if (SchoolType = 1)
                            {
                                $.ajax({
                                    url: '/AFrontOffice/GetSiblingBySub',
                                    data: { SubscriptionId: SelSubscription, searchData: searchData },
                                    success: function (result) {
                                        response($.map(result, function (data, id) {
                                            return {
                                                label: data.FirstName,
                                                value: data.FirstName,
                                                id: data.StudentId
                                            };
                                        }));
                                    },
                                    async: false
                                })
                            }

                        }
                    },
                    minLength: 1,
                    select: function (event, ui) {

                    }
                });





                //alert(searchData)
                //alert(SchoolType + "SchoolType")
                //if (SchoolType == 1 && SelSubscription > 0 ) {

                //    alert(SchoolType + "SchoolType")
                //    debugger
                //    $.ajax({
                //        aynsc:false,
                //        url: '/AFrontOffice/GetSiblingBySub',
                //        data: { SubscriptionId: SelSubscription },
                //        success: function (result) {
                //            debugger
                //            alert(result)
                //            $.each(result, function (i, v) {
                //                var o = { "id": v.StudentId, "DataBaseName": v.FirstName, "Institute": v.AdmissionNumber, "capital": "Kabul" };
                //                countryData.push(o);
                //                alert("Helloooo3")
                //            });
                //        },
                //    })
                //    }
                //alert("Helloooo2")


                //var myData = $("#" + id + "Sibling").tautocomplete({
                //    async: true,
                //    width: "500px",
                //    highlight: "",
                //    columns: ['DataBaseName', 'Institute'],
                //    data: function () {
                //        try {

                //            var data = countryData;
                //        }
                //        catch (e) {
                //            alert(e)
                //        }
                //        var filterData = [];

                //        var searchData = eval("/" + myData.searchdata() + "/gi");

                //        $.each(data, function (i, v) {

                //            if (v.Institute.search(new RegExp(searchData)) != -1) {
                //                filterData.push(v);
                //            }
                //        });
                //        return filterData;
                //    },
                //    onchange: function () {
                //        alert("You selected \"" + myData.text() + "\" and its ID is \"" + myData.id() + "\"");
                //        //$("#country").html(JSON.stringify(myData.all()));
                //    }
                //});;



            };
        </script>

